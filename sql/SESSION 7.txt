USE TEST;

SELECT EID, NAME, CITY FROM EMP;
SELECT  FROM EMP_SAL WHERE DESI ='MANAGER';

SELECT  FROM EMP WHERE DESI LIKE '%MANAGER%';

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN(1004, 1007, 1008, 1010, 1013, 1028,1067);

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI ='DIRECTOR' )
ORDER BY CITY;

SELECT EID, DESI, SALARY FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY ='DELHI');



SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY BETWEEN 200000 AND 300000);

SELECT  FROM TRAINING;

DELETE TRAINING;

SELECT EMP.EID, NAME, DEPT, DESI FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID=EMP_SAL.EID
WHERE DEPT='MIS';

INSERT INTO TRAINING (EID, NAME, DEPT)
SELECT EMP.EID, NAME, DEPT FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID=EMP_SAL.EID
WHERE DEPT='MIS';

UPDATE TRAINING SET MODULE ='SQL';


DELETE FROM TRAINING
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER');

SELECT  FROM EMP_SAL;

SELECT EMP.EID, NAME, DEPT, DESI, SALARY , CITY 
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID=EMP_SAL.EID
WHERE CITY = 'CHANDIGARH' OR CITY ='MUMBAI';

UPDATE EMP_SAL
SET SALARY = SALARY + 10000
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'CHANDIGARH' OR CITY ='MUMBAI');


SELECT COUNT(EID) AS 'TEAM MEMBERS', AVG(SALARY) As 'AVERAGE SALARY' FROM EMP_SAL;

SELECT COUNT(EID) AS 'DELHI TEAM MEMBERS', AVG(SALARY) As 'DELHI EMP AVERAGE SALARY' FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY ='DELHI');


SELECT COUNT(EID) AS 'DELHI TEAM MEMBERS GETTING 1lAC + SAL', AVG(SALARY) As 'DELHI EMP AVERAGE SALARY' FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY ='DELHI'
					AND  EID IN ( SELECT EID FROM EMP_SAL WHERE SALARY  100000));



SELECT  FROM EMP_SAL
WHERE SALARY 100000 AND DEPT = 'HR';

SELECT  FROM EMP_SAL
WHERE EXISTS (SELECT  FROM EMP_SAL WHERE SALARY 200000 AND DEPT ='HR')
AND DEPT ='HR';

SELECT EID, NAME, CITY FROM EMP
WHERE CITY ='GURGAON';

SELECT EMP.EID, NAME, DOJ, DEPT , DESI, SALARY
FROM EMP 
INNER JOIN  EMP_SAL
ON EMP.EID=EMP_SAL.EID
WHERE EMP.EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER');

DROP PROCEDURE PEMP;
CREATE PROCEDURE PEMP
AS
BEGIN
		SELECT  FROM EMP;
END;

EXECUTE PEMP;

EXEC PEMP;

PEMP;

DROP PROCEDURE PDETAIL ;

CREATE PROCEDURE PDETAIL @X AS VARCHAR(20)
AS
BEGIN
	SELECT EMP.EID, NAME, CITY, DOJ, DEPT , DESI , SALARY AS 'BASIC', SALARY .15 AS 'HRA', SALARY .09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID=EMP_SAL.EID
	WHERE DEPT = @X;
END;

PDETAIL 'IT';

CREATE PROCEDURE PSD @X AS VARCHAR(20)
AS
BEGIN
	EXEC ('SELECT  FROM ' + @X);
END;

PSD 'TRAINING';